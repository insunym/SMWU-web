<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>공덕역 후기</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#f8f9fa;}
    .tabs{display:flex;border-bottom:1px solid #ccc;}
    .tab{flex:1;padding:10px;text-align:center;cursor:pointer;}
    .tab.active{font-weight:bold;border-bottom:2px solid #00cec9;}
    .container{padding:20px;}
    #map{width:100%;height:300px;border:1px solid #ccc;}
    .rating{font-size:18px;margin:10px 0;}
    .stars{display:flex;gap:5px;cursor:pointer;}
    .stars span{font-size:24px;color:#ccc;}
    .stars .on{color:#ffdd00;}
    textarea{width:100%;height:80px;margin:10px 0;padding:5px;}
    button{width:100%;padding:8px;background:#00cec9;color:#fff;border:none;cursor:pointer;}
    .reviews{margin-top:20px;}
    .review{border-top:1px solid #ddd;padding:10px 0;}
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active">역 후기</div>
    <div class="tab" onclick="location.href='favorites.html'">즐겨찾는 역</div>
    <div class="tab" onclick="location.href='profile.html'">나의 정보</div>
  </div>
  <div class="container">
    <h1>공덕역 후기</h1>
    <p class="rating">평균 평점: <span id="avgRating">0.0</span></p>
    <div id="map"></div>

    <div class="stars" id="starContainer">
      <span data-value="1">★</span><span data-value="2">★</span>
      <span data-value="3">★</span><span data-value="4">★</span>
      <span data-value="5">★</span>
    </div>
    <textarea id="reviewText" placeholder="후기를 작성하세요..."></textarea>
    <button onclick="addReview()">후기 등록</button>

    <div class="reviews" id="reviews"></div>
  </div>

  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4f4c48c1947a671f9989736da0c6770c"></script>
  <script>
    // 1) 각 역의 위도·경도 설정[2]
    const coords = {lat: 37.543060, lng: 126.951110};
    const map = new kakao.maps.Map(
      document.getElementById('map'),
      { center: new kakao.maps.LatLng(coords.lat, coords.lng), level: 3 }
    );
    new kakao.maps.Marker({ position: new kakao.maps.LatLng(coords.lat, coords.lng), map });

    // 2) 로컬스토리지 기반 후기 관리
    const allReviews = JSON.parse(localStorage.getItem('reviews')) || {};
    let ratings = allReviews['공덕역'] || [];
    let current = 0;

    document.querySelectorAll('#starContainer span').forEach((star,i)=>{
      star.addEventListener('click', ()=>{
        current = i+1;
        document.querySelectorAll('#starContainer span').forEach((s,j)=>
          s.classList.toggle('on', j<current)
        );
      });
    });

    function addReview(){
      const text = document.getElementById('reviewText').value.trim();
      if(current===0||!text) return alert('별점과 후기를 모두 입력해주세요');
      ratings.push(current);
      allReviews['공덕역'] = ratings;
      localStorage.setItem('reviews', JSON.stringify(allReviews));
      const avg = (ratings.reduce((a,b)=>a+b,0)/ratings.length).toFixed(1);
      document.getElementById('avgRating').textContent = avg;
      const div = document.createElement('div');
      div.className = 'review';
      div.innerHTML = `<strong>★${current}</strong> ${text}`;
      document.getElementById('reviews').prepend(div);
      current=0;
      document.querySelectorAll('#starContainer span').forEach(s=>s.classList.remove('on'));
      document.getElementById('reviewText').value = '';
    }
  </script>
</body>
</html>
