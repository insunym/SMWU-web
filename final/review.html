<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="basic.css">
    <link rel="stylesheet" href="navibar.css">
    <link rel="stylesheet" href="station-review.css">
    <title>급하송</title>
</head>
<body>
    <div class="main-container">
        <!-- 탭 메뉴 -->
        <div class="tabs">
            <div class="tab" onclick="location.href='section-select.html'">지도 보기</div>
            <div class="tab active" onclick="location.href='review.html'">역 후기</div>
            <div class="tab" onclick="location.href='favorites.html'">즐겨찾는 역</div>
            <div class="tab" onclick="location.href='profile.html'">나의 정보</div>
        </div>

        <div class="container">
        <!-- 검색 창 -->
        <input id="searchInput" class="search" placeholder="역명을 검색하세요...">
        <!-- 역 카드 그리드 -->
        <div id="stationGrid" class="grid"></div>
        </div>
        <div id="emptyMessage" style="display:none;">검색 결과가 없습니다.</div>
    </div>

    <script type="module">
        import { stations } from './station.js';
        
        const KAKAO_APP_KEY = "4f4c48c1947a671f9989736da0c6770c";

        function getMapImg(lat, lng) {
            return `https://map.kakao.com/staticmap/v2/map?center=${lat},${lng}&level=3&size=240x120&markers=${lat},${lng}&appkey=${KAKAO_APP_KEY}`;
        }

        function renderStations(list) {
            const grid = document.getElementById('stationGrid');
            grid.innerHTML = '';
            list.forEach(station => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.station = station.name;
                card.innerHTML = `
                    <div>
                        <a href="${station.url}">
                        <img src="${getMapImg(station.lat, station.lng)}" alt="${station.name}역" class="station-img">
                        </a>
                    <div>
                    <span>${station.name}역 <span class="heart" data-station="${station.name}">♡</span></span>

                `;
                grid.appendChild(card);
            });
            updateHearts();
            attachHeartEvents();
        }

        // 하트 기능은 그대로
        function getFavorites() {
            return JSON.parse(localStorage.getItem('favorites')) || [];
        }
        function setFavorites(favorites) {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        function toggleHeart(stationName, el) {
            let favorites = getFavorites();
            const idx = favorites.indexOf(stationName);
            if (idx > -1) {
                favorites.splice(idx, 1);
                el.textContent = '♡';
                el.classList.remove('active');
            } else {
                favorites.push(stationName);
                el.textContent = '♥';
                el.classList.add('active');
            }
            setFavorites(favorites);
        }
        function attachHeartEvents() {
            document.querySelectorAll('.heart').forEach(heart => {
                heart.onclick = function(e) {
                    e.stopPropagation();
                    toggleHeart(this.dataset.station, this);
                };
            });
        }
        function updateHearts() {
            const favorites = getFavorites();
            document.querySelectorAll('.heart').forEach(heart => {
                if (favorites.includes(heart.dataset.station)) {
                    heart.textContent = '♥';
                    heart.classList.add('active');
                } else {
                    heart.textContent = '♡';
                    heart.classList.remove('active');
                }
            });
        }

        // 검색 기능
        document.getElementById('searchInput').addEventListener('input', function () {
            const term = this.value.trim().toLowerCase();
            if (!term) {
                renderStations([]); // 검색어 없으면 아무것도 안 보여줌
                document.getElementById('emptyMessage').style.display = 'none';
                return;
            }
            const filtered = stations.filter(station =>
                station.name.toLowerCase().includes(term)
            );
            renderStations(filtered);
            document.getElementById('emptyMessage').style.display = filtered.length ? 'none' : '';
            if (filtered.length === 0) {
                document.getElementById('emptyMessage').style.display = '';
            }
        });

        // 최초에는 아무것도 안 보이게
        renderStations([]);
    </script>
</body>
</html>