<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="basic.css">
  <link rel="stylesheet" href="navibar.css">
  <title>디지털미디어시티역 후기</title>
  <style>
    #map{width:100%;height:300px;border:1px solid #ccc;}
    .rating{font-size:18px;margin:10px 0;}
    .stars{display:flex;gap:5px;cursor:pointer;}
    .stars span{font-size:24px;color:#ccc;}
    .stars .on{color:#ffdd00;}
    textarea {
      width:100%;
      height:80px;
      margin:10px 0;
      padding:5px;}
    button{width:100%;padding:8px;background:#00cec9;color:#fff;border:none;cursor:pointer;}
    .reviews{margin-top:20px;}
    .review{border-top:1px solid #ddd;padding:10px 0;}
  </style>
</head>
<body>
  <div class="main-container">
    <div class="tabs">
      <div class="tab" onclick="location.href='/section-select.html'">지도 보기</div>
      <div class="tab active" onclick="location.href='/review.html'" >역 후기</div>
      <div class="tab" onclick="location.href='/favorites.html'">즐겨찾는 역</div>
      <div class="tab" onclick="location.href='/profile.html'">나의 정보</div>
    </div>
    <div class="container">
      <h1>디지털미디어시티역 후기</h1>
      <p class="rating">평균 평점:<span id="avgRating">0.0</span></p>
      <div id="map"></div>

      <div class="stars" id="starContainer">
        <span data-value="1">★</span>
        <span data-value="2">★</span>
        <span data-value="3">★</span>
        <span data-value="4">★</span>
        <span data-value="5">★</span>
      </div>

      <textarea id="reviewText" placeholder="후기를 작성하세요..."></textarea>
      <button onclick="addReview()">후기 등록</button>
      <div class="reviews" id="reviews"></div>
    </div>
  </div>

  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4f4c48c1947a671f9989736da0c6770c"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Kakao map
  const coords = {lat: 37.576540, lng: 126.901320};
  const map = new kakao.maps.Map(
    document.getElementById('map'),
    { center: new kakao.maps.LatLng(coords.lat, coords.lng), level: 3 }
  );
  new kakao.maps.Marker({ position: new kakao.maps.LatLng(coords.lat, coords.lng), map });

  // 별점 로직
  const allReviews = JSON.parse(localStorage.getItem('reviews')) || {};
  let ratings = allReviews['디지털미디어시티역'] || [];
  let current = 0;

  document.querySelectorAll('#starContainer span').forEach((star, i) => {
    star.addEventListener('click', () => {
      current = i + 1;
      document.querySelectorAll('#starContainer span').forEach((s, j) =>
        s.classList.toggle('on', j < current)
      );
    });
  });

  window.addReview = function () {
    const text = document.getElementById('reviewText').value.trim();
    if (current === 0 || !text) return alert('별점과 후기를 모두 입력해주세요');
    ratings.push(current);
    allReviews['디지털미디어시티역'] = ratings;
    localStorage.setItem('reviews', JSON.stringify(allReviews));
    const avg = (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1);
    document.getElementById('avgRating').textContent = avg;
    const div = document.createElement('div');
    div.className = 'review';
    div.innerHTML = `<strong>★${current}</strong> ${text}`;
    document.getElementById('reviews').prepend(div);
    current = 0;
    document.querySelectorAll('#starContainer span').forEach(s => s.classList.remove('on'));
    document.getElementById('reviewText').value = '';
  };
});
</script>

</body>
</html>
